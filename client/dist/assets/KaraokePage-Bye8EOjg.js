import{_ as Nt,r as d,l as I,o as Ft,m as Et,c as a,a as l,b as m,w as y,d as P,e as Ut,g as p,q as D,h as n,n as h,t as v,v as ut,x as q,y as Gt,z as ct,F as H,i as j,s as A,A as Kt,k as r}from"./index-DY9xsVSO.js";import{u as zt}from"./player-C2Xs0NwX.js";import{M as Bt}from"./MobileNav-B55vU6H0.js";import{g as Dt}from"./media-BmRio5iY.js";const qt="/assets/video_intro.mp4",Ht={class:"karaoke-layout"},jt={class:"dashboard-sidebar"},Qt={class:"sidebar-header"},Wt={class:"sidebar-nav"},Xt={class:"karaoke-main"},Jt={class:"player-wrapper"},Yt={class:"video-container"},Zt={key:0,class:"video-placeholder"},tl={class:"placeholder-content"},ll=["src"],sl={key:1,class:"lyrics-overlay"},el={key:2,class:"song-info-overlay"},ol={class:"controls-bar"},nl={key:0,class:"control-popup-content"},il={class:"popup-header"},al={class:"popup-body"},rl=["disabled"],ul=["disabled"],cl={class:"progress-container"},dl={class:"time-display"},vl={class:"time-display"},pl={class:"controls-main"},bl={class:"controls-left"},ml={class:"controls-center"},gl=["disabled"],yl={class:"controls-right"},fl=["disabled"],kl={class:"desktop-only"},hl=["disabled"],Cl={class:"pitch-control desktop-only"},Sl=["disabled"],Pl=["disabled"],wl={class:"tempo-control desktop-only"},_l=["disabled"],Tl={class:"control-value"},Ml=["disabled"],Rl={class:"volume-control desktop-only"},xl=["value"],Ll={class:"overlay-content"},Vl={class:"overlay-header"},$l={class:"overlay-search"},Il={class:"overlay-filters"},Al=["value"],Ol=["value"],Nl={class:"overlay-songs"},Fl={class:"mobile-left-actions mobile-only"},El=["onClick"],Ul=["onClick"],Gl={class:"song-details"},Kl={class:"song-meta"},zl={key:0},Bl={key:1},Dl={class:"song-actions desktop-only"},ql=["onClick"],Hl=["onClick"],jl={key:0,class:"empty-songs"},Ql={key:1,class:"loading-songs"},Wl={key:1,class:"score-modal"},Xl={class:"score-content"},Jl={class:"score-body"},Yl={class:"score-value"},Zl={key:0,class:"high-score-badge"},ts={__name:"KaraokePage",setup(ls){const Q=Kt(),s=zt(),i=d(null);let c=null,T=null,f=null,M=null,w=null,C=null,S=null;const O=I(()=>s.currentSong),dt=I(()=>O.value?Dt(O.value):""),vt=I(()=>{var g;let e=(g=O.value)==null?void 0:g.video_url_full;if(!e)return"";e.includes("localhost")&&(e=e.replace(/^http(s)?:\/\/localhost(:\d+)?/,""));const t=e.split("/"),u=t.pop();return`${t.join("/")}/${encodeURIComponent(u)}`}),N=d(""),F=d(""),E=d(""),U=d([]),W=d([]),X=d([]),R=d(!1),x=d(""),_=d(!1),J=d(0),Y=d(!1),G=d(.8),b=d(1),L=d(!1),k=d(null),pt=I(()=>s.volume===0?"bi bi-volume-mute-fill":s.volume<.5?"bi bi-volume-down-fill":"bi bi-volume-up-fill"),Z=()=>{if(!(L.value||!i.value))try{c=new(window.AudioContext||window.webkitAudioContext),T=c.createMediaElementSource(i.value),M=c.createChannelSplitter(2),C=c.createGain(),S=c.createGain(),w=c.createChannelMerger(2),f=c.createGain(),T.connect(M),M.connect(C,0),M.connect(S,1),C.connect(w,0,0),C.connect(w,0,1),S.connect(w,0,0),S.connect(w,0,1),w.connect(f),f.connect(c.destination),L.value=!0,tt()}catch(e){console.error("Error initializing Web Audio API:",e),T&&T.connect(c.destination)}},tt=()=>{!C||!S||(s.vocalOn?(C.gain.value=.5,S.gain.value=.5):(C.gain.value=1,S.gain.value=0))},bt=()=>{s.currentSong&&(s.toggleVocal(),tt())},mt=()=>{i.value&&(L.value||(Z(),(c==null?void 0:c.state)==="suspended"&&c.resume()),s.isPlaying?(i.value.pause(),s.pause()):(i.value.play(),s.resume()))},gt=e=>{const t=e.target.currentTime,u=e.target.duration;s.updateTime(t),xt(t),u>0&&t>=u*.9&&!_.value&&!s.loading&&(lt.value||(lt.value=!0,st()))},lt=d(!1),yt=e=>{s.setDuration(e.target.duration)},ft=()=>{s.resume(),(c==null?void 0:c.state)==="suspended"&&c.resume()},kt=()=>{s.pause()},st=async()=>{const e=await s.endCurrentSession();e&&(J.value=e.score,Y.value=e.isHighScore,_.value=!0),s.queue.length>0&&setTimeout(()=>{s.playNext()},2e3)},ht=async()=>{i.value&&(i.value.pause(),i.value.currentTime=0),await s.stop()},Ct=e=>{if(!i.value||!s.duration)return;const t=e.currentTarget.getBoundingClientRect(),o=(e.clientX-t.left)/t.width*s.duration;i.value.currentTime=o,s.updateTime(o)},St=()=>{i.value&&(i.value.currentTime=0),s.updateTime(0)},Pt=()=>{s.queue.length>0&&s.playNext()},wt=e=>{const t=parseFloat(e.target.value);s.setVolume(t),f&&(f.gain.value=t)},_t=()=>{s.volume>0?(G.value=s.volume,s.setVolume(0),f&&(f.gain.value=0)):(s.setVolume(G.value),f&&(f.gain.value=G.value))},et=d(1),K=d(!1),ot=e=>Math.pow(2,e/12),nt=()=>{s.pitch<6&&(s.setPitch(s.pitch+1),z())},it=()=>{s.pitch>-6&&(s.setPitch(s.pitch-1),z())},at=()=>{s.setPitch(0),z()},z=()=>{if(i.value){et.value=ot(s.pitch),i.value.playbackRate=et.value;try{i.value.preservesPitch=K.value,i.value.mozPreservesPitch=K.value,i.value.webkitPreservesPitch=K.value}catch{console.log("preservesPitch not supported")}}},Tt=()=>{b.value<2&&(b.value=Math.min(2,Math.round((b.value+.1)*10)/10),V())},Mt=()=>{b.value>.5&&(b.value=Math.max(.5,Math.round((b.value-.1)*10)/10),V())},Rt=()=>{b.value=1,V()},V=()=>{if(!i.value)return;const t=ot(s.pitch)*b.value;i.value.playbackRate=t;try{i.value.preservesPitch=!0,i.value.mozPreservesPitch=!0,i.value.webkitPreservesPitch=!0}catch{}},xt=e=>{var o;if(!((o=s.currentSong)!=null&&o.lyrics_data)){x.value="";return}const t=s.currentSong.lyrics_data;if(!Array.isArray(t))return;let u="";for(let g=t.length-1;g>=0;g--)if(t[g].time<=e){u=t[g].text;break}x.value=u},Lt=e=>{k.value===e?k.value=null:k.value=e},Vt=()=>{$()},$=async()=>{R.value=!0;try{const e={search:N.value,genre:F.value,language:E.value,limit:50},t=await A.getAll(e);U.value=t.data.data||[]}catch(e){console.error("Error fetching songs:",e)}finally{R.value=!1}},$t=async()=>{try{const[e,t]=await Promise.all([A.getGenres(),A.getLanguages()]);W.value=e.data.data||[],X.value=t.data.data||[]}catch(e){console.error("Error fetching filters:",e)}},B=async e=>{await s.playSong(e),setTimeout(()=>{i.value&&(L.value||Z(),i.value.play(),V())},100)},rt=e=>{s.addToQueue(e)},It=()=>{_.value=!1},At=async()=>{_.value=!1,s.currentSong&&(await s.playSong(s.currentSong),setTimeout(()=>{i.value&&i.value.play()},100))},Ot=async()=>{if(Q.params.songId)try{const e=await A.getById(Q.params.songId);e.data.data&&await B(e.data.data)}catch(e){console.error("Error loading song:",e)}};return Ft(()=>{$(),$t(),Ot()}),Et(()=>{i.value&&i.value.pause(),c&&c.close()}),(e,t)=>{const u=Ut("router-link");return r(),a("div",Ht,[l("aside",jt,[l("div",Qt,[m(u,{to:"/dashboard",class:"brand"},{default:y(()=>[...t[10]||(t[10]=[l("i",{class:"bi bi-music-note-beamed"},null,-1),l("span",null,[P("Karaoke"),l("span",{class:"text-gradient"},"Ku")],-1)])]),_:1})]),l("nav",Wt,[m(u,{to:"/dashboard",class:"nav-item"},{default:y(()=>[...t[11]||(t[11]=[l("i",{class:"bi bi-grid-1x2-fill"},null,-1),l("span",null,"Dashboard",-1)])]),_:1}),m(u,{to:"/karaoke",class:"nav-item active"},{default:y(()=>[...t[12]||(t[12]=[l("i",{class:"bi bi-mic-fill"},null,-1),l("span",null,"Karaoke",-1)])]),_:1}),m(u,{to:"/songs",class:"nav-item"},{default:y(()=>[...t[13]||(t[13]=[l("i",{class:"bi bi-music-note-list"},null,-1),l("span",null,"Pilih Lagu",-1)])]),_:1}),m(u,{to:"/favorites",class:"nav-item"},{default:y(()=>[...t[14]||(t[14]=[l("i",{class:"bi bi-heart-fill"},null,-1),l("span",null,"Lagu Favorit",-1)])]),_:1}),m(u,{to:"/playlists",class:"nav-item"},{default:y(()=>[...t[15]||(t[15]=[l("i",{class:"bi bi-collection-play-fill"},null,-1),l("span",null,"Playlist Saya",-1)])]),_:1}),m(u,{to:"/upload",class:"nav-item"},{default:y(()=>[...t[16]||(t[16]=[l("i",{class:"bi bi-cloud-upload-fill"},null,-1),l("span",null,"Upload Lagu",-1)])]),_:1}),m(u,{to:"/history",class:"nav-item"},{default:y(()=>[...t[17]||(t[17]=[l("i",{class:"bi bi-clock-history"},null,-1),l("span",null,"Riwayat & Score",-1)])]),_:1}),m(u,{to:"/request",class:"nav-item"},{default:y(()=>[...t[18]||(t[18]=[l("i",{class:"bi bi-plus-circle-fill"},null,-1),l("span",null,"Request Lagu",-1)])]),_:1}),m(u,{to:"/donation",class:"nav-item"},{default:y(()=>[...t[19]||(t[19]=[l("i",{class:"bi bi-heart-fill"},null,-1),l("span",null,"Donasi",-1)])]),_:1}),t[21]||(t[21]=l("div",{class:"nav-divider"},null,-1)),m(u,{to:"/settings",class:"nav-item"},{default:y(()=>[...t[20]||(t[20]=[l("i",{class:"bi bi-gear-fill"},null,-1),l("span",null,"Pengaturan",-1)])]),_:1})])]),l("main",Xt,[l("div",Jt,[l("div",{class:"video-glow",style:D({backgroundImage:`url(${dt.value})`})},null,4),l("div",Yt,[n(s).currentSong?p("",!0):(r(),a("div",Zt,[t[26]||(t[26]=l("video",{class:"video-intro",autoplay:"",loop:"",muted:"",playsinline:""},[l("source",{src:qt,type:"video/mp4"})],-1)),l("div",tl,[t[23]||(t[23]=l("i",{class:"bi bi-music-note-beamed"},null,-1)),t[24]||(t[24]=l("h2",null,"KaraokeKu",-1)),t[25]||(t[25]=l("p",null,"Pilih lagu untuk mulai bernyanyi",-1)),l("button",{class:"btn btn-primary btn-lg",onClick:t[0]||(t[0]=o=>n(s).toggleOverlay())},[...t[22]||(t[22]=[l("i",{class:"bi bi-search me-2"},null,-1),P(" Pilih Lagu ",-1)])])])])),l("video",{ref_key:"videoRef",ref:i,class:"video-player",src:vt.value,onTimeupdate:gt,onLoadedmetadata:yt,onEnded:st,onPlay:ft,onPause:kt,crossorigin:"anonymous"},null,40,ll),n(s).currentSong&&x.value?(r(),a("div",sl,[l("p",{class:h(["lyric-line",{active:!0}])},v(x.value),1)])):p("",!0),n(s).currentSong?(r(),a("div",el,[l("h3",null,v(n(s).currentSong.title),1),l("p",null,v(n(s).currentSong.artist),1)])):p("",!0)])]),l("div",ol,[k.value?(r(),a("div",{key:0,class:"mobile-control-overlay",onClick:t[2]||(t[2]=ut(o=>k.value=null,["self"]))},[l("div",{class:h(["mobile-control-popup",k.value])},[k.value==="pitch"?(r(),a("div",nl,[l("div",il,[t[28]||(t[28]=l("i",{class:"bi bi-music-note"},null,-1)),t[29]||(t[29]=l("span",null,"Pitch Control",-1)),l("button",{class:"btn-close-popup",onClick:t[1]||(t[1]=o=>k.value=null)},[...t[27]||(t[27]=[l("i",{class:"bi bi-x"},null,-1)])])]),l("div",al,[l("button",{class:"btn-popup-control",onClick:it,disabled:n(s).pitch<=-12},[...t[30]||(t[30]=[l("i",{class:"bi bi-dash"},null,-1)])],8,rl),l("div",{class:h(["popup-value",{positive:n(s).pitch>0,negative:n(s).pitch<0}])},v(n(s).pitch>0?"+":"")+v(n(s).pitch),3),l("button",{class:"btn-popup-control",onClick:nt,disabled:n(s).pitch>=12},[...t[31]||(t[31]=[l("i",{class:"bi bi-plus"},null,-1)])],8,ul),n(s).pitch!==0?(r(),a("button",{key:0,class:"btn-popup-reset",onClick:at}," Reset ")):p("",!0)])])):p("",!0)],2)])):p("",!0),l("div",cl,[l("span",dl,v(n(s).formattedCurrentTime),1),l("div",{class:"progress-bar",onClick:Ct},[l("div",{class:"progress-fill",style:D({width:n(s).progress+"%"})},null,4),l("div",{class:"progress-thumb",style:D({left:n(s).progress+"%"})},null,4)]),l("span",vl,v(n(s).formattedDuration),1)]),l("div",pl,[l("div",bl,[l("button",{class:"btn-control",onClick:t[3]||(t[3]=o=>n(s).toggleOverlay()),title:"Pilih Lagu"},[...t[32]||(t[32]=[l("i",{class:"bi bi-music-note-list"},null,-1)])])]),l("div",ml,[l("button",{class:"btn-control",onClick:St,title:"Sebelumnya"},[...t[33]||(t[33]=[l("i",{class:"bi bi-skip-start-fill"},null,-1)])]),l("button",{class:"btn-play",onClick:mt,disabled:!n(s).currentSong},[l("i",{class:h(n(s).isPlaying?"bi bi-pause-fill":"bi bi-play-fill")},null,2)],8,gl),l("button",{class:"btn-control",onClick:Pt,title:"Selanjutnya"},[...t[34]||(t[34]=[l("i",{class:"bi bi-skip-end-fill"},null,-1)])]),l("button",{class:"btn-control desktop-only",onClick:ht,title:"Stop"},[...t[35]||(t[35]=[l("i",{class:"bi bi-stop-fill"},null,-1)])])]),l("div",yl,[l("button",{class:h(["btn-control btn-channel",{on:n(s).vocalOn,off:!n(s).vocalOn}]),onClick:bt,title:"Toggle Audio Channel",disabled:!n(s).currentSong},[l("i",{class:h((n(s).vocalOn,"bi bi-mic-fill"))},null,2),l("span",kl,v(n(s).vocalOn?"ON":"OFF"),1)],10,fl),l("button",{class:h(["btn-control mobile-only",{active:k.value==="pitch"}]),onClick:t[4]||(t[4]=o=>Lt("pitch")),title:"Pitch",disabled:!n(s).currentSong},[...t[36]||(t[36]=[l("i",{class:"bi bi-music-note"},null,-1)])],10,hl),l("div",Cl,[t[40]||(t[40]=l("span",{class:"control-label"},"Pitch:",-1)),l("button",{class:"btn-sm-control",onClick:it,disabled:n(s).pitch<=-12,title:"-1"},[...t[37]||(t[37]=[l("i",{class:"bi bi-dash"},null,-1)])],8,Sl),l("span",{class:h(["control-value",{positive:n(s).pitch>0,negative:n(s).pitch<0}])},v(n(s).pitch>0?"+":"")+v(n(s).pitch),3),l("button",{class:"btn-sm-control",onClick:nt,disabled:n(s).pitch>=12,title:"+1"},[...t[38]||(t[38]=[l("i",{class:"bi bi-plus"},null,-1)])],8,Pl),n(s).pitch!==0?(r(),a("button",{key:0,class:"btn-sm-control btn-reset",onClick:at,title:"Reset"},[...t[39]||(t[39]=[l("i",{class:"bi bi-arrow-counterclockwise"},null,-1)])])):p("",!0)]),l("div",wl,[t[44]||(t[44]=l("span",{class:"control-label"},"Tempo:",-1)),l("button",{class:"btn-sm-control",onClick:Mt,disabled:b.value<=.5,title:"Slower"},[...t[41]||(t[41]=[l("i",{class:"bi bi-dash"},null,-1)])],8,_l),l("span",Tl,v(Math.round(b.value*100))+"% ",1),l("button",{class:"btn-sm-control",onClick:Tt,disabled:b.value>=2,title:"Faster"},[...t[42]||(t[42]=[l("i",{class:"bi bi-plus"},null,-1)])],8,Ml),b.value!==1?(r(),a("button",{key:0,class:"btn-sm-control btn-reset",onClick:Rt,title:"Reset"},[...t[43]||(t[43]=[l("i",{class:"bi bi-arrow-counterclockwise"},null,-1)])])):p("",!0)]),l("div",Rl,[l("button",{class:"btn-control",onClick:_t},[l("i",{class:h(pt.value)},null,2)]),l("input",{type:"range",min:"0",max:"1",step:"0.1",value:n(s).volume,onInput:wt,class:"volume-slider"},null,40,xl)])])])]),n(s).showOverlay?(r(),a("div",{key:0,class:"song-overlay",onClick:t[9]||(t[9]=ut(o=>n(s).toggleOverlay(),["self"]))},[l("div",Ll,[l("div",Vl,[t[46]||(t[46]=l("h2",null,"Pilih Lagu",-1)),l("button",{class:"btn-close-overlay",onClick:t[5]||(t[5]=o=>n(s).toggleOverlay())},[...t[45]||(t[45]=[l("i",{class:"bi bi-x-lg"},null,-1)])])]),l("div",$l,[t[47]||(t[47]=l("i",{class:"bi bi-search"},null,-1)),q(l("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=o=>N.value=o),onInput:Vt,placeholder:"Cari judul atau artis...",class:"form-control"},null,544),[[Gt,N.value]])]),l("div",Il,[q(l("select",{"onUpdate:modelValue":t[7]||(t[7]=o=>F.value=o),onChange:$,class:"form-select"},[t[48]||(t[48]=l("option",{value:""},"Semua Genre",-1)),(r(!0),a(H,null,j(W.value,o=>(r(),a("option",{key:o,value:o},v(o),9,Al))),128))],544),[[ct,F.value]]),q(l("select",{"onUpdate:modelValue":t[8]||(t[8]=o=>E.value=o),onChange:$,class:"form-select"},[t[49]||(t[49]=l("option",{value:""},"Semua Bahasa",-1)),(r(!0),a(H,null,j(X.value,o=>(r(),a("option",{key:o,value:o},v(o),9,Ol))),128))],544),[[ct,E.value]])]),l("div",Nl,[(r(!0),a(H,null,j(U.value,o=>(r(),a("div",{key:o.id,class:"overlay-song-item"},[t[56]||(t[56]=l("div",{class:"song-thumbnail desktop-only"},[l("i",{class:"bi bi-music-note"})],-1)),l("div",Fl,[l("button",{class:"btn btn-primary btn-icon-sm",onClick:g=>B(o)},[...t[50]||(t[50]=[l("i",{class:"bi bi-play-fill"},null,-1)])],8,El),l("button",{class:"btn btn-ghost btn-icon-sm",onClick:g=>rt(o)},[...t[51]||(t[51]=[l("i",{class:"bi bi-plus-lg"},null,-1)])],8,Ul)]),l("div",Gl,[l("h4",null,v(o.title),1),l("p",null,v(o.artist),1),l("div",Kl,[o.genre?(r(),a("span",zl,[t[52]||(t[52]=l("i",{class:"bi bi-tag"},null,-1)),P(" "+v(o.genre),1)])):p("",!0),o.language?(r(),a("span",Bl,[t[53]||(t[53]=l("i",{class:"bi bi-globe"},null,-1)),P(" "+v(o.language),1)])):p("",!0)])]),l("div",Dl,[l("button",{class:"btn btn-primary btn-sm",onClick:g=>B(o)},[...t[54]||(t[54]=[l("i",{class:"bi bi-play-fill me-1"},null,-1),P(" Play ",-1)])],8,ql),l("button",{class:"btn btn-ghost btn-sm",onClick:g=>rt(o)},[...t[55]||(t[55]=[l("i",{class:"bi bi-plus-lg"},null,-1)])],8,Hl)])]))),128)),U.value.length===0&&!R.value?(r(),a("div",jl,[...t[57]||(t[57]=[l("i",{class:"bi bi-music-note-beamed"},null,-1),l("p",null,"Tidak ada lagu ditemukan",-1)])])):p("",!0),R.value?(r(),a("div",Ql,[...t[58]||(t[58]=[l("div",{class:"spinner-border text-primary"},null,-1)])])):p("",!0)])])])):p("",!0),_.value?(r(),a("div",Wl,[l("div",Xl,[t[62]||(t[62]=l("div",{class:"score-header"},[l("h2",null,"ðŸŽ‰ Selesai!")],-1)),l("div",Jl,[l("div",Yl,v(J.value),1),t[60]||(t[60]=l("p",null,"Score Kamu",-1)),Y.value?(r(),a("div",Zl,[...t[59]||(t[59]=[l("i",{class:"bi bi-trophy-fill"},null,-1),P(" High Score Baru! ",-1)])])):p("",!0)]),l("div",{class:"score-footer"},[l("button",{class:"btn btn-ghost",onClick:It},"Tutup"),l("button",{class:"btn btn-primary",onClick:At},[...t[61]||(t[61]=[l("i",{class:"bi bi-arrow-repeat me-2"},null,-1),P(" Main Lagi ",-1)])])])])])):p("",!0)]),m(Bt)])}}},is=Nt(ts,[["__scopeId","data-v-2fafdbd3"]]);export{is as default};
